FishNum_Index <- sample(1:length(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticAgeAtMaturityCurve(params, CurveType, nSexes, ObsAgeCl, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
# Save parameters if fitting was successful
if (!is.null(fit)) {
ResampParams[i, ] <- fit$par  # assuming your function returns a list with $par
}
}
# Remove results for failed model fits
ResampParams <- ResampParams[complete.cases(ResampParams), ]
ResampParams
# Remove results for failed model fits
ResampParams <- ResampParams[complete.cases(ResampParams), ]
params
ParamEst <- data.frame(
Parameter = paste0("par", 1:ncol(ResampParams)),
Median    = apply(ResampParams, 2, median, na.rm = TRUE),
Lower2.5  = apply(ResampParams, 2, quantile, probs = 0.025, na.rm = TRUE),
Upper97.5 = apply(ResampParams, 2, quantile, probs = 0.975, na.rm = TRUE)
)
# Print result
ParamEst
ParamEst <- data.frame(
Parameter = paste0("par", 1:ncol(ResampParams)),
Mean    = apply(ResampParams, 2, mean, na.rm = TRUE),
Median    = apply(ResampParams, 2, median, na.rm = TRUE),
Low95CL  = apply(ResampParams, 2, quantile, probs = 0.025, na.rm = TRUE),
Up95CL = apply(ResampParams, 2, quantile, probs = 0.975, na.rm = TRUE)
)
# Print result
ParamEst
ParamEst <- data.frame(
Param = paste0("param", 1:ncol(ResampParams)),
Mean    = apply(ResampParams, 2, mean, na.rm = TRUE),
Median    = apply(ResampParams, 2, median, na.rm = TRUE),
Low95CL  = apply(ResampParams, 2, quantile, probs = 0.025, na.rm = TRUE),
Up95CL = apply(ResampParams, 2, quantile, probs = 0.975, na.rm = TRUE)
)
# Print result
ParamEst
ParamEst[, -1] <- round(ParamEst[, -1], 2)
# Print result
ParamEst
ParamEst <- data.frame(
Params = paste0("Bootstrap results", 1:ncol(ResampParams)),
Mean    = apply(ResampParams, 2, mean, na.rm = TRUE),
Median    = apply(ResampParams, 2, median, na.rm = TRUE),
Low95CL  = apply(ResampParams, 2, quantile, probs = 0.025, na.rm = TRUE),
Up95CL = apply(ResampParams, 2, quantile, probs = 0.975, na.rm = TRUE))
ParamEst[, -1] <- round(ParamEst[, -1], 2)
results = list(nll = res$nll,
convergence = res$convergence,
SampleSize = res$SampleSize,
params = res$params,
ParamEst = ParamEst,
hess.out = NA,
vcov.params = NA,
ses = NA,
cor.params = NA,
ResampParams = ResampParams)
ParamEst
ParamEst <- data.frame(
Params = paste0("param", 1:ncol(ResampParams)),
Mean    = apply(ResampParams, 2, mean, na.rm = TRUE),
Median    = apply(ResampParams, 2, median, na.rm = TRUE),
Low95CL  = apply(ResampParams, 2, quantile, probs = 0.025, na.rm = TRUE),
Up95CL = apply(ResampParams, 2, quantile, probs = 0.975, na.rm = TRUE))
ParamEst[, -1] <- round(ParamEst[, -1], 2)
ParamEst
ParamEst <- data.frame(
Params = paste("param", 1:ncol(ResampParams)),
Mean    = apply(ResampParams, 2, mean, na.rm = TRUE),
Median    = apply(ResampParams, 2, median, na.rm = TRUE),
Low95CL  = apply(ResampParams, 2, quantile, probs = 0.025, na.rm = TRUE),
Up95CL = apply(ResampParams, 2, quantile, probs = 0.975, na.rm = TRUE))
ParamEst[, -1] <- round(ParamEst[, -1], 2)
ParamEst
# Set number of bootstrap iterations
nTrials <- 200
ResampParams <- matrix(NA, nrow = nTrials, ncol = length(params))
ResampConverge <- matrix(NA, nrow = nTrials, ncol = length(params))
for (i in 1:nTrials) {
cat("Trial", i, "\n")
# Resample data
if (LogisticModType==1) { # Length
if (nSexes == 1) {
FishNum_Index <- sample(1:length(ObsLenOrig), replace = TRUE)
ObsLen <- ObsLenOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsLenOrig), replace = TRUE)
ObsLen <- ObsLenOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticLengthAtMaturityCurve(params, CurveType, nSexes, ObsLen, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
if (LogisticModType==2) { # age
if (nSexes == 1) {
FishNum_Index <- sample(1:length(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticAgeAtMaturityCurve(params, CurveType, nSexes, ObsAgeCl, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
ResampConverge[i, ] <- fit$convergence
# Save parameters if fitting was successful
if (!is.null(fit)) {
ResampParams[i, ] <- fit$par  # assuming your function returns a list with $par
}
}
# Remove results for failed model fits
ResampParams <- ResampParams[complete.cases(ResampParams), ]
ParamEst <- data.frame(Params = paste0("param", 1:ncol(ResampParams)),
Mean = apply(ResampParams, 2, mean, na.rm = TRUE),
Median = apply(ResampParams, 2, median, na.rm = TRUE),
Low95CL = apply(ResampParams, 2, quantile, probs = 0.025, na.rm = TRUE),
Up95CL = apply(ResampParams, 2, quantile, probs = 0.975, na.rm = TRUE))
ParamEst[, -1] <- round(ParamEst[, -1], 2)
ResampConverge
ResampConverge <- matrix(NA, nrow = nTrials, ncol = 1)
for (i in 1:nTrials) {
cat("Trial", i, "\n")
# Resample data
if (LogisticModType==1) { # Length
if (nSexes == 1) {
FishNum_Index <- sample(1:length(ObsLenOrig), replace = TRUE)
ObsLen <- ObsLenOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsLenOrig), replace = TRUE)
ObsLen <- ObsLenOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticLengthAtMaturityCurve(params, CurveType, nSexes, ObsLen, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
if (LogisticModType==2) { # age
if (nSexes == 1) {
FishNum_Index <- sample(1:length(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticAgeAtMaturityCurve(params, CurveType, nSexes, ObsAgeCl, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
ResampConverge[i, ] <- fit$convergence
# Save parameters if fitting was successful
if (!is.null(fit)) {
ResampParams[i] <- fit$par  # assuming your function returns a list with $par
}
}
ResampConverge
if (ErrOpt == 1) { # vcov approx
# fit curve and get parameter estimates and uncertainty
res=GetLogisticMaturityCurveResultsErrOpt1(params, nSexes, LogisticModType, CurveType, ObsLen, ObsAgeCl, ObsMatCat)
results = list(nll = res$nll,
convergence = res$convergence,
SampleSize = res$SampleSize,
ParamEst = res$ParamEst,
params = res$params,
vcov.params = res$vcov.params,
ses = res$ses,
cor.params = res$cor.params)
}
if (ErrOpt == 2) { # bootstrap
res=GetLogisticMaturityCurveResultsErrOpt2(params, nSexes, LogisticModType, CurveType, ObsLen, ObsAgeCl, ObsMatCat)
results = list(ResampNLL = ResampNLL,
ResampConverge = ResampConverge,
BootParamEst = ParamEst,
ResampParams = ResampParams,
SampleSize = res$SampleSize)
}
#' @param nSexes c(L50,L95) number of sexes
#' @param LogisticModType 1=length-based, 2=age-based
#' @param CurveType 1=symmetric logistic, 2=asymmetric logistic
#' @param ObsLen vector of observed lengths (set to NA for age model)
#' @param ObsAgeCl vector of observed age classes (set to NA for length model)
#' @param ObsMatCat vector of observed maturity categories (0=immature, 1=mature)
#'
#' @return negative log-likelihood (nll), nlminb convergence diagnostic (convergence), sample size (SampleSize)
#' maturity parameter estimates with lower and upper 95 percent confidence limits (ParamEst), point estimates
#' for growth parameters (params), variance-covariance matrix (vcov.params)
GetLogisticMaturityCurveResultsErrOpt2 <- function(params, nSexes, LogisticModType, CurveType, ObsLen, ObsAgeCl, ObsMatCat) {
ObsLenOrig <- ObsLen
ObsAgeClOrig <- ObsAgeCl
ObsMatCatOrig <- ObsMatCat
# now resample (with replacement), and store parameter estimates for each resampling trial
# Set number of bootstrap iterations
nTrials <- 200
ResampParams <- matrix(NA, nrow = nTrials, ncol = length(params))
ResampConverge <- matrix(NA, nrow = nTrials, ncol = 1)
ResampNLL <- matrix(NA, nrow = nTrials, ncol = 1)
for (i in 1:nTrials) {
cat("Trial", i, "\n")
# Resample data
if (LogisticModType==1) { # Length
if (nSexes == 1) {
FishNum_Index <- sample(1:length(ObsLenOrig), replace = TRUE)
ObsLen <- ObsLenOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsLenOrig), replace = TRUE)
ObsLen <- ObsLenOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticLengthAtMaturityCurve(params, CurveType, nSexes, ObsLen, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
if (LogisticModType==2) { # age
if (nSexes == 1) {
FishNum_Index <- sample(1:length(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticAgeAtMaturityCurve(params, CurveType, nSexes, ObsAgeCl, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
# save convergence and NLL values
ResampConverge[i, ] <- fit$convergence
ResampNLL[i,] <- fit$objective
# Save parameters if fitting was successful
if (!is.null(fit)) {
ResampParams[i] <- fit$par  # assuming your function returns a list with $par
}
}
# Remove results for failed model fits
ResampParams <- ResampParams[complete.cases(ResampParams), ]
ParamEst <- data.frame(Params = paste0("param", 1:ncol(ResampParams)),
Mean = apply(ResampParams, 2, mean, na.rm = TRUE),
Median = apply(ResampParams, 2, median, na.rm = TRUE),
Low95CL = apply(ResampParams, 2, quantile, probs = 0.025, na.rm = TRUE),
Up95CL = apply(ResampParams, 2, quantile, probs = 0.975, na.rm = TRUE))
ParamEst[, -1] <- round(ParamEst[, -1], 2)
results = list(ResampNLL = ResampNLL,
ResampConverge = ResampConverge,
BootParamEst = ParamEst,
ResampParams = ResampParams,
SampleSize = res$SampleSize)
}
if (ErrOpt == 2) { # bootstrap
res=GetLogisticMaturityCurveResultsErrOpt2(params, nSexes, LogisticModType, CurveType, ObsLen, ObsAgeCl, ObsMatCat)
results = list(ResampNLL = ResampNLL,
ResampConverge = ResampConverge,
BootParamEst = ParamEst,
ResampParams = ResampParams,
SampleSize = res$SampleSize)
}
res=GetLogisticMaturityCurveResultsErrOpt2(params, nSexes, LogisticModType, CurveType, ObsLen, ObsAgeCl, ObsMatCat)
warnings()
ObsLenOrig <- ObsLen
ObsAgeClOrig <- ObsAgeCl
ObsMatCatOrig <- ObsMatCat
# Set number of bootstrap iterations
nTrials <- 200
ResampParams <- matrix(NA, nrow = nTrials, ncol = length(params))
ResampConverge <- matrix(NA, nrow = nTrials, ncol = 1)
ResampNLL <- matrix(NA, nrow = nTrials, ncol = 1)
nTrials
params
for (i in 1:nTrials) {
cat("Trial", i, "\n")
# Resample data
if (LogisticModType==1) { # Length
if (nSexes == 1) {
FishNum_Index <- sample(1:length(ObsLenOrig), replace = TRUE)
ObsLen <- ObsLenOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsLenOrig), replace = TRUE)
ObsLen <- ObsLenOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticLengthAtMaturityCurve(params, CurveType, nSexes, ObsLen, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
if (LogisticModType==2) { # age
if (nSexes == 1) {
FishNum_Index <- sample(1:length(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticAgeAtMaturityCurve(params, CurveType, nSexes, ObsAgeCl, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
# save convergence and NLL values
ResampConverge[i, ] <- fit$convergence
ResampNLL[i,] <- fit$objective
# Save parameters if fitting was successful
if (!is.null(fit)) {
ResampParams[i] <- fit$par  # assuming your function returns a list with $par
}
}
for (i in 1:nTrials) {
cat("Trial", i, "\n")
# Resample data
if (LogisticModType==1) { # Length
if (nSexes == 1) {
FishNum_Index <- sample(1:length(ObsLenOrig), replace = TRUE)
ObsLen <- ObsLenOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsLenOrig), replace = TRUE)
ObsLen <- ObsLenOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticLengthAtMaturityCurve(params, CurveType, nSexes, ObsLen, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
if (LogisticModType==2) { # age
if (nSexes == 1) {
FishNum_Index <- sample(1:length(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticAgeAtMaturityCurve(params, CurveType, nSexes, ObsAgeCl, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
# save convergence and NLL values
ResampConverge[i, ] <- fit$convergence
ResampNLL[i,] <- fit$objective
# Save parameters if fitting was successful
if (!is.null(fit)) {
ResampParams[i,] <- fit$par  # assuming your function returns a list with $par
}
}
# Remove results for failed model fits
ResampParams <- ResampParams[complete.cases(ResampParams), ]
ParamEst <- data.frame(Params = paste0("param", 1:ncol(ResampParams)),
Mean = apply(ResampParams, 2, mean, na.rm = TRUE),
Median = apply(ResampParams, 2, median, na.rm = TRUE),
Low95CL = apply(ResampParams, 2, quantile, probs = 0.025, na.rm = TRUE),
Up95CL = apply(ResampParams, 2, quantile, probs = 0.975, na.rm = TRUE))
ParamEst[, -1] <- round(ParamEst[, -1], 2)
results = list(ResampNLL = ResampNLL,
ResampConverge = ResampConverge,
BootParamEst = ParamEst,
ResampParams = ResampParams,
SampleSize = res$SampleSize)
#' @param nSexes c(L50,L95) number of sexes
#' @param LogisticModType 1=length-based, 2=age-based
#' @param CurveType 1=symmetric logistic, 2=asymmetric logistic
#' @param ObsLen vector of observed lengths (set to NA for age model)
#' @param ObsAgeCl vector of observed age classes (set to NA for length model)
#' @param ObsMatCat vector of observed maturity categories (0=immature, 1=mature)
#'
#' @return negative log-likelihood (nll), nlminb convergence diagnostic (convergence), sample size (SampleSize)
#' maturity parameter estimates with lower and upper 95 percent confidence limits (ParamEst), point estimates
#' for growth parameters (params), variance-covariance matrix (vcov.params)
GetLogisticMaturityCurveResultsErrOpt2 <- function(params, nSexes, LogisticModType, CurveType, ObsLen, ObsAgeCl, ObsMatCat) {
ObsLenOrig <- ObsLen
ObsAgeClOrig <- ObsAgeCl
ObsMatCatOrig <- ObsMatCat
# now resample (with replacement), and store parameter estimates for each resampling trial
# Set number of bootstrap iterations
nTrials <- 200
ResampParams <- matrix(NA, nrow = nTrials, ncol = length(params))
ResampConverge <- matrix(NA, nrow = nTrials, ncol = 1)
ResampNLL <- matrix(NA, nrow = nTrials, ncol = 1)
for (i in 1:nTrials) {
cat("Trial", i, "\n")
# Resample data
if (LogisticModType==1) { # Length
if (nSexes == 1) {
FishNum_Index <- sample(1:length(ObsLenOrig), replace = TRUE)
ObsLen <- ObsLenOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsLenOrig), replace = TRUE)
ObsLen <- ObsLenOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticLengthAtMaturityCurve(params, CurveType, nSexes, ObsLen, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
if (LogisticModType==2) { # age
if (nSexes == 1) {
FishNum_Index <- sample(1:length(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[FishNum_Index]
ObsMatCat <- ObsMatCatOrig[FishNum_Index]
} else if (nSexes == 2) {
FishNum_Index <- sample(1:ncol(ObsAgeClOrig), replace = TRUE)
ObsAgeCl <- ObsAgeClOrig[, FishNum_Index]
ObsMatCat <- ObsMatCatOrig[, FishNum_Index]
}
# fit model
fit <- tryCatch({
nlmb = FitLogisticAgeAtMaturityCurve(params, CurveType, nSexes, ObsAgeCl, ObsMatCat)
}, error = function(e) {
cat("Error on bootstrap", i, ":", e$message, "\n")
return(NULL)
})
}
# save convergence and NLL values
ResampConverge[i, ] <- fit$convergence
ResampNLL[i,] <- fit$objective
# Save parameters if fitting was successful
if (!is.null(fit)) {
ResampParams[i,] <- fit$par  # assuming your function returns a list with $par
}
}
# Remove results for failed model fits
ResampParams <- ResampParams[complete.cases(ResampParams), ]
ParamEst <- data.frame(Params = paste0("param", 1:ncol(ResampParams)),
Mean = apply(ResampParams, 2, mean, na.rm = TRUE),
Median = apply(ResampParams, 2, median, na.rm = TRUE),
Low95CL = apply(ResampParams, 2, quantile, probs = 0.025, na.rm = TRUE),
Up95CL = apply(ResampParams, 2, quantile, probs = 0.975, na.rm = TRUE))
ParamEst[, -1] <- round(ParamEst[, -1], 2)
results = list(ResampNLL = ResampNLL,
ResampConverge = ResampConverge,
BootParamEst = ParamEst,
ResampParams = ResampParams,
SampleSize = res$SampleSize)
}
if (ErrOpt == 2) { # bootstrap
res=GetLogisticMaturityCurveResultsErrOpt2(params, nSexes, LogisticModType, CurveType, ObsLen, ObsAgeCl, ObsMatCat)
results = list(ResampNLL = res$ResampNLL,
ResampConverge = res$ResampConverge,
BootParamEst = res$ParamEst,
ResampParams = res$ResampParams,
SampleSize = res$SampleSize)
}
