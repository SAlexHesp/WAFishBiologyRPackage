rm(list=ls())
library(L3Assess)
library(WAFishBiology)
rm(list=ls())
# library(L3Assess)
# library(WAFishBiology)
# Alex Hesp
# 20/11/2025
# Suggested analysis for bight redfish paper revision.
# Fit traditional von Bertalanffy growth model with a relatively informative prior to constrain tzero.
# Prior is currently specified as normal, with a mean of -1.5 (i.e. allowing to be slightly negative), with sd of 1.
# See below plots of distributions for prior vs posterior. We'd need to briefly justify this. I'd prefer sticking
# with 1 prior distribution, stating that sensitivity analyses could be explored for further work (but not in
# this study, as main focus is on LACC method).
# Should also be able to implement relatively easily in WAFishBiology, to make code accessible.
rm(list=ls())
# package not yet updated!!!
# install.packages("C:/~/L3Assess_0.1.0.tar.gz", source = TRUE, repos=NULL)
# install.packages("C:/~/WAFishBiology_0.1.0.tar.gz", source = TRUE, repos=NULL)
# install package from github
# library(devtools)
# devtools::install_github("SAlexHesp/L3AssessRPackage", build_vignettes=TRUE, force=TRUE)
# devtools::install_github("SAlexHesp/WAFishBiologyRPackage", build_vignettes=TRUE, force=TRUE)
# ***************************
# simulate length-at-age data
# ***************************
library(WAFishBiology)
library(L3Assess)
set.seed(123)
rm(list=ls())
# library(L3Assess)
# library(WAFishBiology)
# Alex Hesp
# 20/11/2025
# Suggested analysis for bight redfish paper revision.
# Fit traditional von Bertalanffy growth model with a relatively informative prior to constrain tzero.
# Prior is currently specified as normal, with a mean of -1.5 (i.e. allowing to be slightly negative), with sd of 1.
# See below plots of distributions for prior vs posterior. We'd need to briefly justify this. I'd prefer sticking
# with 1 prior distribution, stating that sensitivity analyses could be explored for further work (but not in
# this study, as main focus is on LACC method).
# Should also be able to implement relatively easily in WAFishBiology, to make code accessible.
rm(list=ls())
# package not yet updated!!!
# install.packages("C:/~/L3Assess_0.1.0.tar.gz", source = TRUE, repos=NULL)
# install.packages("C:/~/WAFishBiology_0.1.0.tar.gz", source = TRUE, repos=NULL)
# install package from github
# library(devtools)
# devtools::install_github("SAlexHesp/L3AssessRPackage", build_vignettes=TRUE, force=TRUE)
# devtools::install_github("SAlexHesp/WAFishBiologyRPackage", build_vignettes=TRUE, force=TRUE)
# ***************************
# simulate length-at-age data
# ***************************
library(WAFishBiology)
library(L3Assess)
set.seed(123)
SampleSize=500 # sample size for retained catches (and same number for released fish, if an MLL is specified)
MaxAge = 80
TimeStep = 1 # model timestep (e.g. 1 = annual, 1/12 = monthly)
NatMort = 0.05
FishMort = 1.5*NatMort
MaxLen = 1000
LenInc = 20
MLL=NA # (minimum legal length) # retention set to 1 for all lengths if MLL set to NA and retention parameters not specified
SelectivityType=2 # 1=selectivity inputted as vector, 2=asymptotic logistic selectivity curve
SelectivityAtLen = NA # selectivity vector
SelParams = c(450, 10) # L50, L95-L50 for gear selectivity
RetenParams = c(NA, NA) # L50, L95-L50 for retention
DiscMort = 0 # proportion of fish that die due to natural mortality
# single sex, von Bertalanffy
GrowthCurveType = 1 # 1 = von Bertalanffy, 2 = Schnute
Linf = 600
vbK = 0.2
CVSizeAtAge = 0.06
GrowthParams = c(Linf, vbK)
RefnceAges = NA
SimRes=SimLenAndAgeFreqData_EqMod(SampleSize, MaxAge, TimeStep, NatMort, FishMort, MaxLen, LenInc, MLL, SelectivityType,
SelParams, RetenParams, SelectivityAtLen, DiscMort, GrowthCurveType, GrowthParams, RefnceAges, CVSizeAtAge)
# plot data
PlotOpt=1 # 0=all plots, 1=retained lengths at age and growth curves, 2=retained plus discard lengths at age
# and growth curves, 3=retained plus discard length frequency, 4=retained plus discard age frequency,
# 5=sex specific retained lengths at age and growth curves, 6=retained plus discard lengths at age and growth curves,
# 7=female length frequency, 8=male length frequency, 9=female age frequency, 10=male age frequency,
# 11=selectivity/retention, 12=F-at-age reten + disc, 13=F-at-age reten, 14=F-at-age disc
PlotSimLenAndAgeFreqData_EqMod(MaxAge, MaxLen, SimRes, PlotOpt)
# ************************
# fit traditional vb model
# ************************
ObsAge = as.vector(SimRes$ObsDecAgeRetCatch)
ObsLen = as.vector(SimRes$ObsRandLenRetCatch)
plot(ObsAge,ObsLen, xlim=c(0,80), ylim=c(0,1000))
DataType=1  # 1=lengths at age data for individual fish, 2=mean length at age and sd data from mixture analysis
nSexes=1
params = c(log(400),log(0.3),0) # log(Linf), log(k), tzero
FittedRes=GetvonBertalanffyGrowthResults(params, nSexes, DataType, ObsAge, ObsLen, ObsMeanLen=NA, ObsMeanLense=NA)
FittedRes$ParamEst
plotages=seq(0, MaxAge,0.1)
